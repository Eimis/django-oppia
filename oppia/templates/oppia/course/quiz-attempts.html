{% extends "base.html" %}
{% load i18n %}
{% load display_functions %}
{% block extra_scripts %}
<script type="text/javascript">
    function init() {
        $('tr[name=attemptlist]').each(function(i) {
            $('#detail' + $(this).attr('id')).toggle();
            $(this).click(function() {
                $('#detail' + $(this).attr('id')).toggle("blind", 1000);
            });
        });
    }
</script>
{% endblock extra_scripts %}
{% block extra_body %}
onload="init();"
{% endblock extra_body %}
{% block content %}

<h2><a href="{% url 'oppia_recent_activity' course.id %}">{{ course.title|title_lang:LANGUAGE_CODE }}</a>
&gt; <a href="{% url 'oppia_course_quiz' course.id %}">{% trans 'title_quizzes' %}</a>
&gt; {{ quiz.title|title_lang:LANGUAGE_CODE }} </h2>
<p><i>{% trans 'Tags:' %} {{ course.get_tags}}</i></p>

{% if page.object_list %}
	{% include "oppia/includes/page_navigator.html" %}
	<div class="table-responsive">
         <table class="table">
         	 <thead>
                <tr>
                  <th>{% trans 'table_header_attempt_date' %}</th>
                  <th>{% trans 'table_header_attempt_name' %}</th>
                  <th>{% trans 'table_header_attempt_score' %}</th>
                </tr>
              </thead>
              <tbody>
	{% for a in page.object_list %}
		<tr id='{{ a.id }}' name="attemptlist" class="hover">
			<td>{{ a.attempt_date }}</td>
			<td>{% if OPPIA_SHOW_GRAVATARS %}
       				{{ a.user|gravatar:24 }}
       			{% endif %}
       			{% if request.user.is_staff %}
					<a href="{% url 'profile_user_activity' a.user.id %}">{{ a.user.first_name }} {{ a.user.last_name }}</a>
				{% else %}
					{{ a.user.first_name }} {{ a.user.last_name }}
				{% endif %}</td>
			<td>{{ a.get_score_percent }}%</td>
		</tr>
		<tr id='detail{{ a.id }}'>
			<td colspan="6">
				 <div class="table-responsive">
        			 <table class="table table-striped">
			         	 <thead>
			                <tr>
			                  <th>{% trans 'Question' %}</th>
			                  <th>{% trans 'Response' %}</th>
                              <!--If there are 'essay' type questions...:-->
                              <th>{% trans 'Feedback' %}</th>
			                  <th>{% trans 'Score' %}</th>
			                </tr>
			              </thead>
			              <tbody>
				{% for r in a.responses %}
					<tr>
						<td>
                            {{ r.question.title|title_lang:LANGUAGE_CODE }}
                            {% if r.question.type == 'essay' %}
                            <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target=".feedback-modal-{{ r.id }}">
                                    {% trans 'Add score / feedback' %}
                                </button>
                            {% endif %}
                        </td>
						<td>{{ r.text }}</td>
                        {% if r.question.type == 'essay' %}
                            <td>{{ r.feedback|default:"" }}</td>
                        {% endif %}
						<td>{{ r.get_score_percent }}%</td>
					</tr>
			{% endfor %}
			</tbody>
 		</table>
			</td>
		</tr>
	{% endfor %}
				</tbody>
 		</table>
	</div>
	{% include "oppia/includes/page_navigator.html" %}
{% else %}
	<p>{% trans 'No attempts yet' %}</p>
{% endif %}

<!--We are displaying each QuizAttemptResponse's ModelForm in a Bootstrap's modal-->
<!--here. If question type is 'essay', a button is shown near the question and-->
<!--this modal can be called.-->
<form method="post" action="">
    {% csrf_token %}
    {{ formset.management_form }}
    {% for form in formset.forms %}
    {% with response=form.instance %}

            <!-- Modal -->
            <div class="modal fade feedback-modal-{{ response.id }}" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">

                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">{{ course.title|title_lang:LANGUAGE_CODE }}</h4>
                  </div>

                  <div class="modal-body">
                    <p><strong>{% trans 'Quiz' %}: </strong>{{ quiz.title|title_lang:LANGUAGE_CODE }}</p>
                    <p><strong>{% trans 'Completed on' %}: </strong>{{ response.quizattempt.submitted_date }}</p>
                    <p><strong>{% trans 'Max. available score' %}: </strong>{{ response.question.get_maxscore }}</p>
                    <br>
                    <table class="table">
                      <tr>
                        <th>{% trans 'Question' %}</th>
                        <td>{{ response.question.title }}</td>
                      </tr>
                      <tr>
                        <th>{% trans 'Response' %}</th>
                        <td>{{ response.text }}</td>
                      </tr>
                      {% for field in form %}
                      <tr>
                          {% if field.label = 'Id' %}
                          <th style="visibility: hidden;">{{ field.label }}</th>
                          {% else %}
                          <th>{{ field.label }}</th>
                          {% endif %}
                          <td>{{ field }}</td>
                      </tr>
                      {% endfor %}
                    </table>
                  </div>

                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{% trans 'Close' %}</button>
                    <button type="submit" class="btn btn-primary">{% trans 'Save changes' %}</button>
                  </div>

                </div> <!--Modal-->
              </div> <!--Modal-dialog-->
            </div> <!--Modal-content-->
    {% endwith %}
    {% endfor %}
</form>

{% endblock content %}
